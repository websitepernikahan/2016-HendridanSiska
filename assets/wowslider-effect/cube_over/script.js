// cube_over
// options.direction - left,right,down,up
// use: Modernizr library
// based on: http://alexdunphy.github.io/refineslide/demo.html
// shadow algorithm from : http://tympanus.net/Tutorials/3DShadingWithBoxShadows/
// create .ws_effect
// options.fallback 
// options.staticColor - true not use RGBaster
jQuery.extend(jQuery.easing,{easeInOutBack:function(c,g,h,r,a,k){void 0==k&&(k=1.70158);return 1>(g/=a/2)?r/2*g*g*(((k*=1.525)+1)*g-k)+h:r/2*((g-=2)*g*(((k*=1.525)+1)*g+k)+2)+h}});
function ws_cube_over(c,g,h){function r(c,f){f=f||{};var g=f.exclude||[],d,a=document.createElement("canvas"),b=a.getContext("2d");a.width=c.naturalWidth;a.height=c.naturalHeight;b.drawImage(c,0,0,c.naturalWidth,c.naturalHeight);try{d=b.getImageData(f.x?f.x:0,f.y?f.y:0,f.w?f.w:c.width,f.h?f.h:c.height).data}catch(h){return console.log("error:unable to access image data: "+h),"#ccc"}for(var a=(f.w?f.w:c.width*f.h?f.h:c.height)||d.length,b={},e="",k=[],x="",y=0,n=0;n<a;){k[0]=d[n];k[1]=d[n+1];k[2]=
d[n+2];e=k.join(",");b[e]=e in b?b[e]+1:1;if(-1===g.indexOf(["rgb(",e,")"].join(""))){var l=b[e];l>y&&(x=e,y=l)}n+=4}return["rgb(",x,")"].join("")}var a=jQuery,k=a(this),l=/WOW Slider/g.test(navigator.userAgent),z=a(".ws_list",h),A=c.perspective||/MSIE|Trident/g.test(navigator.userAgent)?1E3:2E3,p={position:"absolute",backgroundSize:"cover",left:0,top:0,width:"100%",height:"100%",backfaceVisibility:"hidden"},q=/AppleWebKit/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),e=a("<div>").css(p).css({transformStyle:"preserve-3d",
perspective:q&&!l?"none":A,zIndex:8});a("<div>").addClass("ws_effect ws_cube_over").css(p).append(e).appendTo(h);if(!c.support.transform&&c.fallback)return new c.fallback(c,g,h);var u;this.go=function(v,f){function B(b,a,d,e){b.parent().css("perspective",A);b.width();b.height();wowAnimate(b,{scale:1,translate:[0,0,q&&!l?d:0]},{scale:.85,translate:[0,0,q&&!l?d:0]},.4*c.duration,"easeInOutBack",function(){wowAnimate(b,{scale:.85,translate:[0,0,q&&!l?d:0]},{scale:1,translate:[0,0,q&&!l?d:0]},.4*c.duration,
c.duration-.8*c.duration,"easeInOutBack",e)});wowAnimate(a.front.item,{rotateY:0,rotateX:0},{rotateY:a.front.rotateY,rotateX:a.front.rotateX},c.duration,"easeInOutBack");wowAnimate(a.back.item,{rotateY:a.back.rotateY,rotateX:a.back.rotateX},{rotateY:0,rotateX:0},c.duration,"easeInOutBack");wowAnimate(a.side.item,{rotateY:a.side.rotateY,rotateX:a.side.rotateX},{rotateY:-a.side.rotateY,rotateX:-a.side.rotateX},c.duration,"easeInOutBack")}var d=a(g[f]),d={width:d.width(),height:d.height(),marginTop:parseFloat(d.css("marginTop")),
marginLeft:parseFloat(d.css("marginLeft"))};if(c.support.transform&&c.support.perspective){u&&u.stop();var m=h.width(),b=h.height(),b={left:[m/2,0,0,180,0,-180],right:[m/2,0,0,-180,0,180],down:[b/2,-b/2,180,0,-180,0],up:[b/2,b/2,-180,0,180,0]}[c.direction||["left","right","down","up"][Math.floor(4*Math.random())]],w=a("<img>").css(d),t=a("<img>").css(d).attr("src",g.get(v).src),m=a("<div>").css({overflow:"hidden",transformOrigin:"50% 50% -"+b[0]+"px"}).css(p).append(w).appendTo(e),d=a("<div>").css({overflow:"hidden",
transformOrigin:"50% 50% -"+b[0]+"px"}).css(p).append(t).appendTo(e),t=a('<div class="ws_cube_side">').css({transformOrigin:"50% 50% -"+b[0]+"px",background:c.staticColor?"":r(t[0],{exclude:["0,0,0","255,255,255"]})}).css(p).appendTo(e);w.on("load",function(){z.hide()});w.attr("src",g.get(f).src).load();e.parent().show();u=new B(e,{front:{item:m,rotateY:b[5],rotateX:b[4]},back:{item:d,rotateY:b[3],rotateX:b[2]},side:{item:t,rotateY:b[3]/2,rotateX:b[2]/2}},-b[0],function(){k.trigger("effectEnd");e.empty().parent().hide();
u=0})}else e.css({position:"absolute",display:"none",zIndex:2,width:"100%",height:"100%"}),e.stop(1,1),b=!!((v-f+1)%g.length)^c.revers?"left":"right",m=a("<div>").css({position:"absolute",left:"0%",right:"auto",top:0,width:"100%",height:"100%"}).css(b,0).append(a(g[f]).clone().css({width:100*d.width/h.width()+"%",height:100*d.height/h.height()+"%",marginLeft:100*d.marginLeft/h.width()+"%"})).appendTo(e),d=a("<div>").css({position:"absolute",left:"100%",right:"auto",top:0,width:"0%",height:"100%"}).append(a(g[v]).clone().css({width:100*
d.width/h.width()+"%",height:100*d.height/h.height()+"%",marginLeft:100*d.marginLeft/h.width()+"%"})).appendTo(e),e.css({left:"auto",right:"auto",top:0}).css(b,0).show(),e.show(),z.hide(),d.animate({width:"100%",left:0},c.duration,"easeInOutExpo",function(){a(this).remove()}),m.animate({width:0},c.duration,"easeInOutExpo",function(){k.trigger("effectEnd");e.empty().hide()})}};
